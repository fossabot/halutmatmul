name: HW Design Verification

on: push

jobs:
  changes:
    uses: ./.github/workflows/filter.yaml

  icarus_simulations:
    needs: changes
    if: ${{ needs.changes.outputs.hardware == 'true' }}
    runs-on: ubuntu-latest
    container:
      image: joennlae/halutmatmul-conda-hw:latest
    defaults:
      run:
        shell: bash -el {0}
    steps:
    - uses: actions/checkout@v2
    - name: Simulate and run DV with icarus
      run: |
        source /venv/bin/activate
        cd hardware
        fusesoc --cores-root=. run --target=icarus halut:test:scm
        fusesoc --cores-root=. run --target=icarus halut:test:fp_adder
        fusesoc --cores-root=. run --target=icarus halut:test:fp_16_to_32_convert
        fusesoc --cores-root=. run --target=icarus halut:test:fp_16_32_adder
        fusesoc --cores-root=. run --target=icarus halut:test:fp_16_comparision
        fusesoc --cores-root=. run --target=icarus halut:test:halut_encoder
        fusesoc --cores-root=. run --target=icarus halut:test:halut_decoder
        fusesoc --cores-root=. run --target=icarus halut:test:halut_encoder_4
        fusesoc --cores-root=. run --target=icarus halut:test:halut_decoder_x
